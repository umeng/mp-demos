"use strict";function n(n){e(wx.request,n)}function e(n,e){var t=e.success,i=e.fail,r=!1,o=null;e.success=function(n){if(!r){o&&clearTimeout(o);"function"==typeof t&&t(n)}};e.fail=function(){if(!r){o&&clearTimeout(o);"function"==typeof i&&i()}};n(e);o=setTimeout(()=>{o&&clearTimeout(o);r=!0;"function"==typeof i&&i(r)},e.timeout||Y)}function t(e){try{V.getNetworkInfo(function(t){if("NOTREACHABLE"===t.networkType||"none"===t.networkType||!1===t.networkAvailable){P().e("请求失败:暂无网络 ");e.fail()}else n(e)},e.fail)}catch(n){P().e("请求失败: "+n)}}function i(n){return tn.encode(n,!1)}function r(n){return tn.decode(n)}function o(n){for(var e="",t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(n);i++)e+=t[Math.round(Math.random()*(t.length-1))];return e}function s(n){return!Number.isNaN(parseInt(n,10))}function c(n,e){for(var t=String(n).split("."),i=String(e).split("."),r=0;r<Math.max(t.length,i.length);r++){var o=parseInt(t[r]||0,10),s=parseInt(i[r]||0,10);if(o>s)return 1;if(o<s)return-1}return 0}function u(n){return JSON.parse(JSON.stringify(n))}function a(n,e){this.id=n;this.ts=Date.now();var t=typeof e;if("string"===t&&e)this[n]=e;else if("object"===t)for(var i in e)({}).hasOwnProperty.call(e,i)&&(this[i]=e[i])}function f(n){var e=null;switch(n){case En.HALF_SESSION:e=l();break;case En.CLOSE_SESSION:e=d();break;case En.EKV:e=h()}return e}function l(){var n=null,e=Sn().cloneCurrentSession();e&&(n={header:{st:"1"},analytics:{sessions:[e]}});return n}function d(){var n=null,e={},t=Sn().cloneCurrentSession();if(t){var i=H().get(),r=cn().get();Array.isArray(i)&&i.length&&(t.pages=rn.clone(i));Array.isArray(r)&&r.length&&(t.shares=rn.clone(r));H().clear();cn().clear();e.sessions=[t]}var o=ln().getEkvs();if(o){e.ekvs=rn.clone(o);ln().clear()}(e.sessions||e.ekvs)&&(n={analytics:e});return n}function h(){var n=null,e=ln().getEkvs();if(e){n={analytics:{ekvs:rn.clone(e)}};ln().clear()}return n}function p(n){return{h:g(n.header,In),a:_(n.analytics,mn)}}function g(n,e){var t=v(n,e);n.id_tracking&&(t[e.id_tracking||"id_tracking"]=v(n.id_tracking,An));return t}function v(n,e){var t={};for(var i in n)e[i]?t[e[i]]=n[i]:t[i]=n[i];return t}function _(n,e){var t={};if(n){var i=n.ekvs,r=n.sessions;i&&(t[e.ekvs]=i);Array.isArray(r)&&(t[e.sessions]=r)}return t}function y(n,e,i,r){yn.instance().setIdType(on().getIdType());yn.instance().setIdTracking(on().getIdTracking());var o=rn.clone(yn.instance().get());n.header=Object.assign(o,n.header,{ts:Date.now()});var s=p(n),c=C.stringify(s),u={url:x.LOG_URL,method:"POST",data:rn.base64Encode(c),success:function(n){var t=n.code||n.status||n.statusCode;if(200===t||413===t){P().i("数据发送成功: ",c);E((n.data||{}).imprint);"function"==typeof e&&e(n)}else{P().w("数据发送失败: ",c);"function"==typeof i&&i()}},fail:function(n){P().w("超时: ",c);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};t(Object.assign(u,S()))}function E(n){if(n){U().set(x.IMPRINT,n);yn.instance().setItem(x.IMPRINT,n);var e=C.parse(rn.base64Decode(n));P().v("imprint: %o",e);var t=e.report_policy;if(t&&rn.isNumber(t)){U().set(x.REPORT_POLICY,t);if(t===x.REPORT_POLICY_INTERVAL){var i=e.report_interval;if(i&&rn.isNumber(i)){i<=x.EVENT_SEND_MIN_INTERVAL?i=x.EVENT_SEND_MIN_INTERVAL:i>x.EVENT_SEND_MAX_INTERVAL&&(i=x.EVENT_SEND_MAX_INTERVAL);U().set(x.REPORT_INTERVAL_TIME,i)}}}}}function S(){;"wxmp/json";return{header:{"Content-Type":"wxmp/json","Msg-Type":"wxmp/json"}}}function m(n){var e=n,t=[];this.enqueue=function(n){"number"==typeof e&&this.size()>=e&&this.dequeue();t.push(n)};this.dequeue=function(){return t.shift()};this.front=function(){return t[0]};this.isEmpty=function(){return 0===t.length};this.clear=function(){t.length=0};this.size=function(){return t.length};this.items=function(){return t};this.print=function(){console.log(t.toString())}}function I(){function n(){on().init(function(){yn.instance().init();P().v("Header初始化成功")})}function e(n){var e=!1,t=U().get(x.REPORT_POLICY);if(t&&t===x.REPORT_POLICY_INTERVAL){var i=U().get(x.REPORT_INTERVAL_TIME),r=U().get(x.EVENT_LAST_SEND_TIME);e=!r;i=i||x.EVENT_SEND_MIN_INTERVAL;var o=n-r;e=e||o>1e3*i}return e}function t(n){U().set(x.EVENT_LAST_SEND_TIME,n)}function i(n,e){if(!n||"string"!=typeof n){P().e('please check trackEvent id. id should be "string" and not null');return!1}if(n.length>x.MAX_EVENTID_LENGTH){P().e("The maximum length of event id shall not exceed "+x.MAX_EVENTID_LENGTH);return!1}if(e&&("object"!=typeof e||Array.isArray(e))&&"string"!=typeof e){P().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof e){var t=0;for(var i in e)if({}.hasOwnProperty.call(e,i)){if(i.length>x.MAX_PROPERTY_KEY_LENGTH){P().e("The maximum length of property key shall not exceed "+x.MAX_PROPERTY_KEY_LENGTH);return!1}if(t>=x.MAX_PROPERTY_KEYS_COUNT){P().e("The maximum count of properties shall not exceed "+x.MAX_PROPERTY_KEYS_COUNT);return!1}t+=1}}return!0}var r=!1,o=!1;this.init=function(e){P().v("sdk version: "+x.IMPL_VERSION);r?P().v("Lib重复实例化"):U().load(function(){P().v("cache初始化成功: ",U().getAll());n();r=!0;"function"==typeof e&&e();P().tip("SDK集成成功")})};this.resume=function(n){if(r&&!o){P().v("showOptions: ",n);o=!0;Nn().load();var e=Sn().resume(n),t=Sn().getCurrentSessionId();ln().setSessionId(t);if(e){var i=this;Nn().add(En.HALF_SESSION,function(){b().useOpenid()&&b().autoGetOpenid()&&!on().getId()?on().getOpenIdAsync({success:function(n){P().v("获取openid成功: %s",n);i.setOpenid(n)},fail:function(){P().v("获取openid失败")}}):Nn().send()})}}};this.pause=function(){if(r){o=!1;Sn().pause();Nn().send(En.CLOSE_SESSION,function(){Nn().save();U().save();P().v("cache save success")})}};this.setOpenid=function(n){if(!on().getId()){P().v("setOpenId: %s",n);on().setOpenid(n);Nn().send()}};this.setUnionid=function(n){P().v("setUnionid: %s",n);on().setUnionid(n)};this.setUserid=function(n){P().v("setUserid: %s",n);on().setUserid(n)};this.trackEvent=function(n,o){if(r){P().v("event: ",n,o);if(i(n,o)){ln().addEvent(n,o);var s=Date.now();if(e(s)){t(s);Nn().send(En.EKV,function(){})}}}};this.trackShare=function(n){if(r){try{n=cn().add(n);P().v("sharePath: ",n.path)}catch(n){P().v("shareAppMessage: ",n)}return n}};this.trackPageStart=function(n){r&&H().addPageStart(n)};this.trackPageEnd=function(n){r&&H().addPageEnd(n)}}function A(){}function N(n,e,t){var i=n[e];n[e]=function(n){t.call(this,n);i&&i.call(this,n)}}function T(n){try{Ln.init(n)}catch(n){P().v("onAppLaunch: ",n)}}function O(n){try{Ln.resume(n)}catch(n){P().v("onAppShow: ",n)}}function R(){try{Ln.pause()}catch(n){P().v("onAppHide: ",n)}}function w(){try{Ln.trackPageStart(this.route)}catch(n){P().v("onPageShow: ",n)}}function k(){try{Ln.trackPageEnd(this.route)}catch(n){P().v("onPageHide: ",n)}}var L="[UMENG] -- ",P=function(){function n(){this.setDebug=function(n){t=n};this.d=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.debug.apply(console,arguments)}catch(n){}};this.i=function(){try{if(t)try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.info.apply(console,arguments)}catch(n){}}catch(n){}};this.e=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.error.apply(console,arguments)}catch(n){}};this.w=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.v=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.t=function(){if(t)try{console.table.apply(console,arguments)}catch(n){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.tip_w=function(){try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=L+arguments[0]);console.error.apply(console,arguments)}catch(n){}}}var e=null,t=!1;return function(){null===e&&(e=new n);return e}}(),D={set:function(n,e,t){var i,r={key:n,success:function(n){"function"==typeof t&&t(n)},fail:function(){"function"==typeof t&&t()}};r.data=e;i=wx.setStorage;try{i&&i(r)}catch(n){P.e("存储错误",n)}},get:function(n,e){var t;t=wx.getStorage;try{t&&t({key:n,success:function(n){"function"==typeof e&&e(n.data)},fail:function(t){P().w(n+": "+t.errMsg);"function"==typeof e&&e()}})}catch(n){P.e("获取storage错误",n)}},remove:function(n,e){var t;t=wx.removeStorage;try{t&&t({key:n,success:function(){"function"==typeof e&&e(!0)},fail:function(){"function"==typeof e&&e(!1)}})}catch(n){P.e("删除storage错误",n)}}},C={stringify:function(n){if(n)try{return JSON.stringify(n)}catch(n){}return""},parse:function(n){if(n)try{return JSON.parse(n)}catch(n){}return null},parseToArray:function(n){if(n)try{return JSON.parse(n)}catch(n){}return[]}},b=function(){function n(){var n={};this.useOpenid=function(){return n.useOpenid};this.autoGetOpenid=function(){return n.autoGetOpenid};this.appKey=function(){return n.appKey};this.set=function(e){n=e};this.get=function(){return n};this.setItem=function(e,t){n[e]=t};this.getItem=function(e){return n[e]}}var e=null;return function(){e||(e=new n);return e}}(),U=function(){function n(){this.load=function(n){if(i){D.remove(t);n()}else{t="um_cache_"+b().appKey();D.get(t,function(e){i=C.parse(e)||{};r=!0;D.remove(t);n()})}};this.save=function(){i&&D.set(t,C.stringify(i))};this.set=function(n,e){i&&(i[n]=e)};this.get=function(n){return(i||{})[n]};this.remove=function(n){i&&i[n]&&delete i[n]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(n){return!!this.get(n)};this.isLoaded=function(){return r}}var e=null,t="",i=null,r=!1;return function(t){e||(e=new n(t));return e}}(),M="",x={SESSION_INTERVAL:3e4,LOG_URL:M="https://ulogs.umeng.com/wxm_logs",GET_OPENID_URL:"https://ulogs.umeng.com/uminiprogram_logs/wx/getuut",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_MIN_INTERVAL:5,EVENT_SEND_MAX_INTERVAL:86400,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.2.1-1",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},V={getUserInfo:function(n){wx.getSetting({success(e){e.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){n(e&&e.userInfo)},fail:function(){n({})}}):n({})},fail(){n({})}})},getSystemInfo:function(n,e){wx.getSystemInfo({success:function(e){"function"==typeof n&&n(e)},fail:function(){"function"==typeof e&&e()}})},getDeviceInfo:function(n){"function"==typeof n&&n()},checkNetworkAvailable:function(n){var e={success:function(e){var t=!1;t="none"!==e.networkType;"function"==typeof n&&n(t)},fail:function(){"function"==typeof n&&n()}};wx.getNetworkType(e)},getNetworkInfo:function(n,e){var t={success:function(e){"function"==typeof n&&n(e)},fail:function(){"function"==typeof e&&e()}};wx.getNetworkType(t)},getDeviceId:function(n,e){try{"function"==typeof n&&n("")}catch(n){P().e("getDeviceId error",n)}},getAdvertisingId:function(n,e){"function"==typeof n&&n("")},getPageName:function(){},onNetworkStatusChange:function(n){wx.onNetworkStatusChange(function(e){"function"==typeof n&&n(e.isConnected||!0)})}},H=function(){function n(){var n=!1,e=null,t=[];this.addPageStart=function(t){if(t&&!n){e={ts:Date.now(),path:t};n=!0}};this.addPageEnd=function(i){if(n&&i&&e&&i===e.path){var r=Date.now()-e.ts;e.duration=Math.abs(r);t.push(e);e=null;n=!1}};this.get=function(){return t};this.clear=function(){t.length=0}}var e=null;return function(){e||(e=new n);return e}}(),Y=5e3,G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K=function(n){for(var e={},t=0,i=n.length;t<i;t++)e[n.charAt(t)]=t;return e}(G),F=String.fromCharCode,j=function(n){if(n.length<2)return(e=n.charCodeAt(0))<128?n:e<2048?F(192|e>>>6)+F(128|63&e):F(224|e>>>12&15)+F(128|e>>>6&63)+F(128|63&e);var e=65536+1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320);return F(240|e>>>18&7)+F(128|e>>>12&63)+F(128|e>>>6&63)+F(128|63&e)},X=function(n){return n.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,j)},q=function(n){var e=[0,2,1][n.length%3],t=n.charCodeAt(0)<<16|(n.length>1?n.charCodeAt(1):0)<<8|(n.length>2?n.charCodeAt(2):0);return[G.charAt(t>>>18),G.charAt(t>>>12&63),e>=2?"=":G.charAt(t>>>6&63),e>=1?"=":G.charAt(63&t)].join("")},z=function(n){return n.replace(/[\s\S]{1,3}/g,q)},J=function(n){return z(X(n))},Q=function(n,e){return e?J(String(n)).replace(/[+\/]/g,function(n){return"+"==n?"-":"_"}).replace(/=/g,""):J(String(n))},B=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),W=function(n){switch(n.length){case 4:var e=((7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3))-65536;return F(55296+(e>>>10))+F(56320+(1023&e));case 3:return F((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return F((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Z=function(n){return n.replace(B,W)},$=function(n){var e=n.length,t=e%4,i=(e>0?K[n.charAt(0)]<<18:0)|(e>1?K[n.charAt(1)]<<12:0)|(e>2?K[n.charAt(2)]<<6:0)|(e>3?K[n.charAt(3)]:0),r=[F(i>>>16),F(i>>>8&255),F(255&i)];r.length-=[0,0,2,1][t];return r.join("")},nn=function(n){return n.replace(/[\s\S]{1,4}/g,$)},en=function(n){return Z(nn(n))},tn={encode:Q,decode:function(n){return en(String(n).replace(/[-_]/g,function(n){return"-"==n?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}},rn={base64Encode:i,base64Decode:r,isNumber:s,compareVersion:c,getRandomStr:o,clone:u},on=function(){function n(){function n(){return rn.getRandomStr(10)+Date.now()+rn.getRandomStr(7)+x.UUID_SUFFIX}var e="",i="",r="",o="",s="";this.init=function(t){s=b().useOpenid()?"openid":"uuid";D.get(x.UUID,function(r){if(r)e=r;else{e=n();D.set(x.UUID,e)}b.useOpenid?D.get(x.OPENID,function(n){i=n;t&&t()}):t&&t()})};this.getOpenIdAsync=function(n){wx.login({success:function(e){e.code?t({url:x.GET_OPENID_URL,method:"GET",data:{key:b().appKey(),code:e.code},success:function(e){if(e&&200===e.statusCode&&e.data&&e.data.data){var t=e.data.data;return n.success&&n.success(t.oid,t.uid)}n.fail&&n.fail()},fail:function(){n.fail&&n.fail()}}):n.fail&&n.fail()},fail:function(){n.fail&&n.fail()}})};this.getIdType=function(){return s};this.getIdTracking=function(){var n={};e&&(n.uuid=e);i&&(n.openid=i);r&&(n.unionid=r);o&&(n.userid=o);return n};this.setOpenid=function(n){if(!i&&n){i=n;D.set(x.OPENID,n)}};this.setUnionid=function(n){if(!r&&n){r=n;D.set(x.UNIONID,n)}};this.setUserid=function(n){if(!o&&n){o=n;D.set(x.USERID,n)}};this.getId=function(){return b().useOpenid()?i:e}}var e=null;return function(){e||(e=new n);return e}}(),sn=3,cn=function(){function n(){return{add:function(n){P().v("share origin: %o",n);var e={title:n.title,path:n.path.split("?")[0],_um_sts:Date.now()},r=n.path,o=on().getId();if(o){var s=i.split(","),c=(s=s.filter(function(n){return n.length>0})).indexOf(o);c>=0&&(s=s.slice(0,c));s.length<sn&&s.push(o);var u=s.join(",");-1!==r.indexOf("?")?r+="&_um_ssrc="+u:r+="?_um_ssrc="+u;var a=Date.now();r+="&_um_sts="+a;n.path=r;e._um_ssrc=u;e._um_sts=a}t.push(e);P().v("share: %o",n);return n},setShareSource:function(n){i=n},clear:function(){t.length=0},get:function(){return t}}}var e=null,t=[],i="";return function(){e||(e=new n);return e}}(),un="ekvs",an=1e4,fn=1,ln=function(){function n(){if(s.length){var n=U().get(un);if(t(n)+s.length<=an){n=e(n,s);U().set(un,n)}}}function e(n,e){var t=(n=n||{})[o];Array.isArray(t)&&t.length?n[o]=t.concat(e):n[o]=[].concat(e);return n}function t(n){var e=0;for(var t in n)Array.isArray(n[t])&&(e+=n[t].length);return e}function i(){return{addEvent:function(e,t){var i=new a(e,t);if(o){s.unshift(i);if(s.length>fn){n(o);s.length=0}}else{P().w("session id is null: ",o);c.unshift(i)}},setSessionId:function(n){o=n;P().v("setSessionId: ",o);if(Array.isArray(c)&&c.length&&o){for(var e=0;e<c.length;e++)this.addEvent(c[e]);c.length=0}},getEkvs:function(){var n=U().get(un);s&&s.length&&(n=e(n,s));return n},clear:function(){U().remove(un);s.length=0}}}var r,o,s=[],c=[];return function(){r||(r=i());return r}}(),dn="2g",hn="3g",pn="4g",gn="none",vn=" ",_n=["access","access_subtype"],yn=function(){function n(){function n(n){V.getSystemInfo(function(i){V.getNetworkInfo(function(o){var s=o.type||o.networkType;s===gn&&(s="unknown");var c=U().get(x.IMPRINT);c&&(r.imprint=c);e(i,s);t(i);n&&n()})})}function e(n,e,t){r.userInfo=t;r.device_type="Phone";r.sdk_version=x.IMPL_VERSION;r.appkey=b().appKey();if(n){var i,o,s,c=n.model||"",u=(n.product,n.platform||""),a=n.brand||"",f=a.toLowerCase();r.platform_sdk_version=n.SDKVersion;r.platform_version=n.version;s=(i=Math.round(n.screenWidth*n.pixelRatio))>(o=Math.round(n.screenHeight*n.pixelRatio))?i+"*"+o:o+"*"+i;r.os=u;r.font_size_setting=n.fontSizeSetting;r.device_model=c.toLowerCase().indexOf(f)>-1?c:f+vn+c;r.device_brand=a;r.device_manufacturer=f;r.device_manuid=c.toLowerCase().indexOf(f)>-1?c:f+vn+c;r.device_name=c.toLowerCase().indexOf(f)>-1?c:f+vn+c;r.os_version=n.system;r.resolution=s;r.language=n.language}switch(e){case pn:r.access_subtype="LTE";r.access="4G";break;case hn:r.access_subtype="CDMA";r.access="3G";break;case dn:r.access_subtype="GRPS";r.access="2G";break;default:r.access=e;delete r.access_subtype}}function t(n){var e=[];if(n){e.push({name:"系统名",value:n.platform});e.push({name:"支付宝版本号",value:n.version})}e.push({name:"设备型号",value:r.device_model});e.push({name:"设备生产商",value:r.device_brand});e.push({name:"os版本号",value:r.os_version});e.push({name:"网络类型",value:r.access});e.push({name:"运营商",value:r.access_subtype});e.push({name:"分辨率",value:r.resolution});e.push({name:"screenWidth",value:n.screenWidth});e.push({name:"screenHeight",value:n.screenHeight});e.push({name:"pixelRatio",value:n.pixelRatio});for(var t="",i=0;i<e.length;i++){var o=e[i];t+=o.name+": "+o.value+"; "}P().v("调试辅助信息: ",t)}var i=!1,r={};r.sdk_type="wxmp";r.platform="wx";return{init:function(){n(function(){i=!0})},isLoaded:function(){return i},get:function(){return r},getSDKType:function(){return r.sdk_type},getPlatform:function(){return r.platform},getRealtimeFields:function(){var n={};_n.forEach(function(e){n[e]=r[e]});return n},setIdTracking:function(n){this.setItem("id_tracking",n)},setIdType:function(n){this.setItem("id_type",n)},setItem:function(n,e){r[n]=e},getItem:function(n){return r[n]},updateExtraInfo:function(){V.getDeviceInfo(function(n){r.device_info=n||""})}}}var e=null;return{instance:function(){e||(e=n());return e}}}(),En={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv"},Sn=function(){function n(){return{resume:function(n){var e=!1;s||(s=U().get(x.CURRENT_SESSION));var i=new Date;o=i.getTime();if(!s||!s.end_time||o-s.end_time>x.SESSION_INTERVAL){e=!0;t(n);P().v("开始新的session(%s): ",s.id,s)}else P().v("延续上一次session(%s): %s ",s.id,i.toLocaleTimeString(),s);return e},pause:function(){i()},getCurrentSessionId:function(){return(s||{}).id},getCurrentSession:function(){return s},cloneCurrentSession:function(){return rn.clone(s)}}}function e(n){var e={};for(var t in n)0===t.indexOf("_um_")&&(e[t]=n[t]);return e}function t(n){try{var t=(s||{}).options||{},i=Object.assign({},e(n.query));i.path=n.path||t.path;i.scene=n.scene?yn.instance().getPlatform()+"_"+n.scene:t.scene;P().v("session options: ",i);var r=i[x.UM_SSRC];r&&cn().setShareSource(r);var o=Date.now();s={id:rn.getRandomStr(10)+o,start_time:o,options:i}}catch(n){P().e("生成新session失败: ",n)}}function i(){if(s){var n=new Date;s.end_time=n.getTime();"number"!=typeof s.duration&&(s.duration=0);s.duration=s.end_time-o;U().set(x.CURRENT_SESSION,s);P().v("退出会话(%s): %s ",s.id,n.toLocaleTimeString(),s)}}var r=null,o=null,s=null;return function(){r||(r=n());return r}}(),mn={sessions:"sn",ekvs:"e"},In={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl"},An={uuid:"ud",unionid:"und",openid:"od",alipay_id:"ad",device_id:"dd",userid:"cuid"},Nn=function(){function n(e,t){if(yn.instance().isLoaded()){var i=f(e),r=yn.instance().getRealtimeFields();i.header=Object.assign({},i.header,r);u.enqueue(i);"function"==typeof t&&t()}else setTimeout(function(){n(e,t)},100)}function e(n){var i=u.front(),r=function(){u.dequeue();e(n)},o=function(){var t=u.dequeue();t&&c.push(t);e(n)};if(i)y(i,r,o);else{t();n()}}function t(){c.forEach(function(n){u.enqueue(n)});c.length=0}function i(n){if(on().getId())s?P().i("队列正在发送中"):V.checkNetworkAvailable(function(t){if(!1!==t){s=!0;e(function(){s=!1;"function"==typeof n&&n()})}else"function"==typeof n&&n()});else{P().i("获取id标识失败，暂缓发送");"function"==typeof n&&n()}}function r(){this.send=function(n,e){n?this.add(n,function(){i(e)}):i(e)};this.add=function(e,t){n(e,t)};this.load=function(){var n=U().get(x.REQUESTS);n&&n.length&&n.forEach(function(n){u.enqueue(n)});U().remove(x.REQUESTS)};this.save=function(){U().set(x.REQUESTS,rn.clone(u.items()));u.clear()}}var o=null,s=!1,c=[],u=new m(50);return function(){o||(o=new r);return o}}(),Tn=[];A.prototype={createMethod:function(n,e,t){try{n[e]=t?function(){return t[e].apply(t,arguments)}:function(){Tn.push([e,[].slice.call(arguments)])}}catch(n){P().v("create method errror: ",n)}},installApi:function(n,e){try{var t,i,r=["resume","pause","trackEvent","trackPageStart","trackPageEnd","trackShare","setOpenid","setUnionid","setUserid"];for(t=0,i=r.length;t<i;t++)this.createMethod(n,r[t],e);if(e)for(t=0,i=Tn.length;t<i;t++){var o=Tn[t];try{e[o[0]].apply(e,o[1])}catch(n){P().v("impl[v[0]].apply error: ",o[0],n)}}}catch(n){P().v("install api errror: ",n)}}};try{var On=App;App=function(n){N(n,"onLaunch",function(){T(n.umengConfig)});N(n,"onShow",O);N(n,"onHide",R);On(n)}}catch(n){P().w("App重写异常")}try{var Rn=Page;Page=function(n){N(n,"onShow",w);N(n,"onHide",k);N(n,"onUnload",k);if(n.onShareAppMessage){var e=n.onShareAppMessage;n.onShareAppMessage=function(n){var t=e.call(this,n);return Ln.trackShare.call(this,t)}}Rn(n)}}catch(n){P().w("Page重写异常")}try{var wn=Component;Component=function(n){try{n.methods=n.methods||{};var e=n.methods;N(e,"onShow",w);N(e,"onHide",k);N(e,"onUnload",k);if(e.onShareAppMessage){var t=e.onShareAppMessage;e.onShareAppMessage=function(n){var e=t.call(this,n);return Ln.trackShare.call(this,e)}}wn(n)}catch(e){wn(n)}}}catch(n){P().w("Component重写异常")}var kn=new A,Ln={_inited:!1,init:function(n){if(this._inited)P().v("已经实例过，请避免重复初始化");else if(n)if(n.appKey){b().set(n);P().setDebug(n.debug);this._inited=!0;var e=this;if(b().useOpenid()){P().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取")}!function(n){try{var e=new I;P().v("成功创建Lib对象");e.init(function(){P().v("Lib对象初始化成功");kn.installApi(n,e);P().v("安装Lib接口成功")})}catch(n){P().w("创建Lib对象异常: "+n)}}(e)}else P().err("请确保传入正确的appkey");else P().err("请通过在App内添加umengConfig设置相关信息！")}};try{kn.installApi(Ln,null);P().v("安装临时接口成功");wx.uma=Ln}catch(n){P().w("uma赋值异常: ",n)}module.exports=Ln;
